<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>DEEPFAKE IMAGE DETECTION</title>

<style>
    body {
        margin: 0;
        font-family: Arial, sans-serif;
        background: linear-gradient(135deg, #3a0ca3, #7209b7, #560bad);
        color: white;
        text-align: center;
        padding: 20px;
    }

    h1 {
        font-size: 42px;
        margin-bottom: 5px;
    }

    .tabs {
        margin-top: 20px;
    }

    .tab-btn {
        background: #b5179e;
        padding: 10px 20px;
        margin: 5px;
        border-radius: 10px;
        border: none;
        color: white;
        cursor: pointer;
        font-size: 16px;
        transition: background 0.3s;
    }

    .tab-btn:hover {
        background: #d90368;
    }

    .container {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 30px;
        margin-top: 40px;
        padding: 20px;
    }

    .box {
        background: rgba(255, 255, 255, 0.1);
        padding: 20px;
        border-radius: 20px;
        border: 1px solid rgba(255, 255, 255, 0.3);
    }

    .upload-area {
        border: 2px dashed white;
        padding: 40px;
        border-radius: 20px;
        margin-top: 20px;
        cursor: pointer;
        transition: background 0.3s;
    }

    .upload-area:hover {
        background: rgba(255, 255, 255, 0.1);
    }

    .choose-file {
        background: #f72585;
        padding: 10px 20px;
        border-radius: 10px;
        display: inline-block;
        margin-top: 10px;
        cursor: pointer;
        transition: background 0.3s;
    }

    .choose-file:hover {
        background: #d90368;
    }

    .preview-image {
        max-width: 100%;
        max-height: 300px;
        margin-top: 20px;
        border-radius: 10px;
    }

    .result-card {
        background: rgba(255, 255, 255, 0.2);
        padding: 20px;
        border-radius: 15px;
        margin-top: 20px;
    }

    .result-label {
        font-size: 32px;
        font-weight: bold;
        margin: 10px 0;
    }

    .real {
        color: #4ade80;
    }

    .fake {
        color: #f87171;
    }

    .confidence-bar {
        background: rgba(255, 255, 255, 0.2);
        border-radius: 10px;
        height: 30px;
        margin: 20px 0;
        overflow: hidden;
    }

    .confidence-fill {
        height: 100%;
        border-radius: 10px;
        transition: width 0.5s ease;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: bold;
    }

    .loading {
        display: none;
        margin-top: 20px;
    }

    .spinner {
        border: 4px solid rgba(255, 255, 255, 0.3);
        border-top: 4px solid white;
        border-radius: 50%;
        width: 40px;
        height: 40px;
        animation: spin 1s linear infinite;
        margin: 20px auto;
    }

    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }

    .probabilities {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 10px;
        margin-top: 20px;
    }

    .prob-box {
        background: rgba(255, 255, 255, 0.1);
        padding: 15px;
        border-radius: 10px;
    }

    .tab-content {
        display: none;
    }

    .tab-content.active {
        display: block;
    }

    .tab-btn.active {
        background: #d90368;
    }

    .architecture-diagram {
        background: rgba(255, 255, 255, 0.1);
        padding: 30px;
        border-radius: 15px;
        margin: 20px 0;
    }

    .model-box {
        background: rgba(255, 255, 255, 0.15);
        padding: 20px;
        border-radius: 10px;
        margin: 10px 0;
    }

    .metric-card {
        background: rgba(255, 255, 255, 0.15);
        padding: 20px;
        border-radius: 10px;
        text-align: center;
    }

    .metric-value {
        font-size: 36px;
        font-weight: bold;
        margin: 10px 0;
    }

    .chart-container {
        background: rgba(255, 255, 255, 0.1);
        padding: 20px;
        border-radius: 15px;
        margin: 20px 0;
        height: 300px;
    }

    .comparison-table {
        width: 100%;
        margin: 20px 0;
        border-collapse: collapse;
    }

    .comparison-table th,
    .comparison-table td {
        padding: 15px;
        text-align: left;
        border-bottom: 1px solid rgba(255, 255, 255, 0.2);
    }

    .comparison-table th {
        background: rgba(255, 255, 255, 0.2);
        font-weight: bold;
    }

    .layer-flow {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 20px;
        margin: 20px 0;
        flex-wrap: wrap;
    }

    .layer-item {
        background: rgba(255, 255, 255, 0.2);
        padding: 15px 25px;
        border-radius: 10px;
        position: relative;
    }

    .arrow {
        font-size: 24px;
        color: rgba(255, 255, 255, 0.6);
    }

    .connection-status {
        position: fixed;
        top: 10px;
        right: 10px;
        background: rgba(255, 255, 255, 0.15);
        padding: 12px 18px;
        border-radius: 20px;
        font-size: 14px;
        display: flex;
        align-items: center;
        gap: 8px;
        border: 1px solid rgba(255, 255, 255, 0.2);
        z-index: 1000;
    }

    .status-indicator {
        width: 10px;
        height: 10px;
        border-radius: 50%;
        animation: pulse 2s infinite;
    }

    .status-indicator.connected {
        background: #4ade80;
    }

    .status-indicator.disconnected {
        background: #f87171;
        animation: none;
    }

    @keyframes pulse {
        0%, 100% { opacity: 1; }
        50% { opacity: 0.5; }
    }

</style>
</head>

<body>

<div class="connection-status" id="connectionStatus">
    <div class="status-indicator disconnected" id="statusIndicator"></div>
    <span id="statusText">Connecting...</span>
</div>

<h1>DEEPFAKE IMAGE DETECTION</h1>
<p>CNN + Vision Transformer Detection</p>

<div class="tabs">
    <button class="tab-btn active" onclick="showTab('detector')">DeepFake Detector</button>
    <button class="tab-btn" onclick="showTab('architecture')">System Architecture</button>
    <button class="tab-btn" onclick="showTab('comparison')">Model Comparison</button>
    <button class="tab-btn" onclick="showTab('metrics')">Performance Metrics</button>
</div>

<!-- Tab 1: DeepFake Detector -->
<div id="detector" class="tab-content active">
<div class="container">

    <!-- Upload Image Section -->
    <div class="box">
        <h2>Upload Image for Analysis</h2>

        <div class="upload-area" id="uploadArea">
            <p style="font-size: 50px;">üì∏</p>
            <p>Upload an image to analyze</p>

            <input type="file" id="imageInput" accept="image/*" style="display:none;">
            <label for="imageInput" class="choose-file">Choose File</label>
            
            <img id="previewImage" class="preview-image" style="display:none;">
        </div>

        <div class="loading" id="loading">
            <div class="spinner"></div>
            <p>Analyzing image...</p>
        </div>
    </div>

    <!-- Analysis Results Section -->
    <div class="box">
        <h2>Analysis Results</h2>

        <div id="resultsDefault">
            <p style="font-size:60px;">üß†</p>
            <p>Ready for Analysis</p>
            <p style="opacity:0.7;">Upload an image to see detailed DeepFake detection results</p>
        </div>

        <div id="resultsContent" style="display:none;">
            <div class="result-card">
                <p style="font-size:50px;" id="resultEmoji">üîç</p>
                <div class="result-label" id="resultLabel">-</div>
                <p id="confidenceText">-</p>
                
                <div class="confidence-bar">
                    <div class="confidence-fill" id="confidenceFill">-</div>
                </div>

                <div class="probabilities">
                    <div class="prob-box">
                        <p style="font-size:24px;">‚úÖ</p>
                        <p style="font-size:12px; opacity:0.7;">REAL</p>
                        <p style="font-size:20px; font-weight:bold;" id="probReal">-</p>
                    </div>
                    <div class="prob-box">
                        <p style="font-size:24px;">‚ùå</p>
                        <p style="font-size:12px; opacity:0.7;">FAKE</p>
                        <p style="font-size:20px; font-weight:bold;" id="probFake">-</p>
                    </div>
                </div>

                <p style="font-size:12px; opacity:0.6; margin-top:20px;">
                    Model: ResNet18 + ViT-B/16 | Validation AUC: 99.32%
                </p>
            </div>
        </div>
    </div>

</div>
</div>

<!-- Tab 2: System Architecture -->
<div id="architecture" class="tab-content">
    <div class="container" style="grid-template-columns: 1fr;">
        <div class="box">
            <h2>üèóÔ∏è Hybrid Model Architecture</h2>
            <p>CNN (ResNet18) + Vision Transformer (ViT-B/16)</p>

            <div class="architecture-diagram">
                <div class="layer-flow">
                    <div class="layer-item">
                        <strong>Input Image</strong><br>
                        <small>224√ó224√ó3</small>
                    </div>
                    <div class="arrow">‚Üí</div>
                    
                    <div class="layer-item" style="background: rgba(245, 37, 133, 0.3);">
                        <strong>CNN Branch</strong><br>
                        <small>ResNet18</small>
                    </div>
                    <div class="arrow">‚Üí</div>
                    
                    <div class="layer-item">
                        <strong>CNN Features</strong><br>
                        <small>512-dim</small>
                    </div>
                </div>

                <div class="layer-flow">
                    <div class="layer-item">
                        <strong>Input Image</strong><br>
                        <small>224√ó224√ó3</small>
                    </div>
                    <div class="arrow">‚Üí</div>
                    
                    <div class="layer-item" style="background: rgba(114, 9, 183, 0.3);">
                        <strong>ViT Branch</strong><br>
                        <small>ViT-B/16</small>
                    </div>
                    <div class="arrow">‚Üí</div>
                    
                    <div class="layer-item">
                        <strong>ViT Features</strong><br>
                        <small>768-dim</small>
                    </div>
                </div>

                <div class="layer-flow">
                    <div class="layer-item" style="background: rgba(217, 3, 104, 0.3);">
                        <strong>Concatenate</strong><br>
                        <small>1280-dim</small>
                    </div>
                    <div class="arrow">‚Üí</div>
                    
                    <div class="layer-item">
                        <strong>MLP Classifier</strong><br>
                        <small>1280‚Üí512‚Üí1</small>
                    </div>
                    <div class="arrow">‚Üí</div>
                    
                    <div class="layer-item" style="background: rgba(76, 222, 128, 0.3);">
                        <strong>Output</strong><br>
                        <small>Real/Fake</small>
                    </div>
                </div>
            </div>

            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 30px;">
                <div class="model-box">
                    <h3>üìä Model Details</h3>
                    <p><strong>Total Parameters:</strong> 97,894,209</p>
                    <p><strong>Trainable Parameters:</strong> 97,894,209</p>
                    <p><strong>CNN Backbone:</strong> ResNet18 (Pretrained)</p>
                    <p><strong>ViT Backbone:</strong> ViT-B/16 (Pretrained)</p>
                    <p><strong>Optimizer:</strong> AdamW (lr=1e-4)</p>
                    <p><strong>Loss:</strong> BCEWithLogitsLoss</p>
                </div>

                <div class="model-box">
                    <h3>üéØ Training Setup</h3>
                    <p><strong>Dataset:</strong> 8,000 training images</p>
                    <p><strong>Validation:</strong> 1,000 images</p>
                    <p><strong>Test:</strong> 1,000 images</p>
                    <p><strong>Epochs:</strong> 5</p>
                    <p><strong>Batch Size:</strong> 8</p>
                    <p><strong>Training Time:</strong> ~6.6 hours (CPU)</p>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Tab 3: Model Comparison -->
<div id="comparison" class="tab-content">
    <div class="container" style="grid-template-columns: 1fr;">
        <div class="box">
            <h2>üìä Model Comparison</h2>
            
            <table class="comparison-table">
                <thead>
                    <tr>
                        <th>Model</th>
                        <th>Architecture</th>
                        <th>Parameters</th>
                        <th>Test AUC</th>
                        <th>Accuracy</th>
                    </tr>
                </thead>
                <tbody>
                    <tr style="background: rgba(76, 222, 128, 0.2);">
                        <td><strong>Our Model ‚≠ê</strong></td>
                        <td>ResNet18 + ViT-B/16</td>
                        <td>97.9M</td>
                        <td><strong>99.05%</strong></td>
                        <td><strong>~99%</strong></td>
                    </tr>
                    <tr>
                        <td>ResNet18 Only</td>
                        <td>CNN (ResNet18)</td>
                        <td>11.7M</td>
                        <td>~95%</td>
                        <td>~93%</td>
                    </tr>
                    <tr>
                        <td>ResNet50 Only</td>
                        <td>CNN (ResNet50)</td>
                        <td>25.6M</td>
                        <td>~96%</td>
                        <td>~94%</td>
                    </tr>
                    <tr>
                        <td>ViT Only</td>
                        <td>Vision Transformer</td>
                        <td>86.6M</td>
                        <td>~97%</td>
                        <td>~95%</td>
                    </tr>
                    <tr>
                        <td>EfficientNet-B0</td>
                        <td>CNN (EfficientNet)</td>
                        <td>5.3M</td>
                        <td>~94%</td>
                        <td>~92%</td>
                    </tr>
                </tbody>
            </table>

            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 30px;">
                <div class="model-box">
                    <h3>‚úÖ Advantages of Hybrid Model</h3>
                    <p>‚úì <strong>Best Performance:</strong> 99.05% AUC</p>
                    <p>‚úì <strong>Dual Features:</strong> Local + Global patterns</p>
                    <p>‚úì <strong>Robust Detection:</strong> Works on various deepfakes</p>
                    <p>‚úì <strong>Pretrained Weights:</strong> ImageNet initialization</p>
                    <p>‚úì <strong>High Confidence:</strong> Reliable predictions</p>
                </div>

                <div class="model-box">
                    <h3>‚ö° Performance Insights</h3>
                    <p>üìà <strong>CNN Branch:</strong> Detects texture artifacts</p>
                    <p>üîç <strong>ViT Branch:</strong> Captures facial inconsistencies</p>
                    <p>üéØ <strong>Combined:</strong> Superior to individual models</p>
                    <p>‚è±Ô∏è <strong>Inference:</strong> ~5-10 seconds (CPU)</p>
                    <p>üí™ <strong>Generalization:</strong> Works on unseen data</p>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Tab 4: Performance Metrics -->
<div id="metrics" class="tab-content">
    <div class="container">
        <div class="box">
            <h2>üìà Training Performance</h2>
            
            <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; margin: 20px 0;">
                <div class="metric-card">
                    <p style="opacity:0.7;">Validation AUC</p>
                    <div class="metric-value" style="color: #4ade80;">99.32%</div>
                    <p style="font-size:12px; opacity:0.6;">Epoch 3 (Best)</p>
                </div>
                
                <div class="metric-card">
                    <p style="opacity:0.7;">Test AUC</p>
                    <div class="metric-value" style="color: #4ade80;">99.05%</div>
                    <p style="font-size:12px; opacity:0.6;">Final Model</p>
                </div>
                
                <div class="metric-card">
                    <p style="opacity:0.7;">Training Loss</p>
                    <div class="metric-value" style="color: #60a5fa;">0.237</div>
                    <p style="font-size:12px; opacity:0.6;">Epoch 4</p>
                </div>
                
                <div class="metric-card">
                    <p style="opacity:0.7;">Validation Loss</p>
                    <div class="metric-value" style="color: #60a5fa;">0.137</div>
                    <p style="font-size:12px; opacity:0.6;">Epoch 4</p>
                </div>
            </div>

            <div class="chart-container">
                <h3>Training Progress (5 Epochs)</h3>
                <canvas id="trainingChart"></canvas>
            </div>
        </div>

        <div class="box">
            <h2>üéØ Detailed Metrics</h2>
            
            <div class="model-box" style="margin: 20px 0;">
                <h3>Per-Epoch Performance</h3>
                <table class="comparison-table">
                    <thead>
                        <tr>
                            <th>Epoch</th>
                            <th>Train Loss</th>
                            <th>Val Loss</th>
                            <th>Val AUC</th>
                            <th>Time</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>0</td>
                            <td>0.4630</td>
                            <td>0.2390</td>
                            <td>97.05%</td>
                            <td>1.7h</td>
                        </tr>
                        <tr>
                            <td>1</td>
                            <td>0.3351</td>
                            <td>0.1532</td>
                            <td>98.84%</td>
                            <td>1.2h</td>
                        </tr>
                        <tr>
                            <td>2</td>
                            <td>0.2983</td>
                            <td>0.3294</td>
                            <td>98.79%</td>
                            <td>1.2h</td>
                        </tr>
                        <tr style="background: rgba(76, 222, 128, 0.2);">
                            <td><strong>3 ‚≠ê</strong></td>
                            <td>0.2578</td>
                            <td>0.2802</td>
                            <td><strong>99.32%</strong></td>
                            <td>1.2h</td>
                        </tr>
                        <tr>
                            <td>4</td>
                            <td>0.2373</td>
                            <td>0.1369</td>
                            <td>99.03%</td>
                            <td>1.3h</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div class="model-box">
                <h3>üìä Key Statistics</h3>
                <p><strong>Best Epoch:</strong> 3 (Validation AUC: 99.32%)</p>
                <p><strong>Total Training Time:</strong> ~6.6 hours</p>
                <p><strong>Final Test Performance:</strong> 99.05% AUC</p>
                <p><strong>Model Stability:</strong> Consistent performance</p>
                <p><strong>Convergence:</strong> Achieved in 5 epochs</p>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    // API Configuration
    const API_CONFIG = {
        host: window.location.hostname,
        port: 5000,
        getBaseUrl: function() {
            if (window.location.port === '5000') {
                return '';  // Use relative URLs when on Flask server
            } else {
                return `http://${this.host}:${this.port}`;
            }
        }
    };

    // Connection status check
    async function checkConnection() {
        try {
            const healthUrl = API_CONFIG.getBaseUrl() + '/health';
            console.log('Checking connection to:', healthUrl);
            
            const response = await fetch(healthUrl, {
                method: 'GET',
                headers: {
                    'Accept': 'application/json',
                }
            });
            
            if (response.ok) {
                const data = await response.json();
                console.log('Connected to backend:', data);
                setConnectionStatus(true);
                return true;
            } else {
                console.warn('Health check returned status:', response.status);
                setConnectionStatus(false);
                return false;
            }
        } catch (error) {
            console.error('Connection check failed:', error);
            setConnectionStatus(false);
            return false;
        }
    }

    function setConnectionStatus(connected) {
        const indicator = document.getElementById('statusIndicator');
        const statusText = document.getElementById('statusText');
        
        if (connected) {
            indicator.className = 'status-indicator connected';
            statusText.textContent = '‚úì Backend Connected';
        } else {
            indicator.className = 'status-indicator disconnected';
            statusText.textContent = '‚úó Backend Offline';
        }
    }

    // Check connection on page load and periodically
    window.addEventListener('load', function() {
        console.log('Page loaded, checking backend connection...');
        checkConnection();
        
        // Recheck every 5 seconds
        setInterval(checkConnection, 5000);
    });

    // Tab switching functionality
    function showTab(tabName) {
        // Hide all tabs
        const tabs = document.querySelectorAll('.tab-content');
        tabs.forEach(tab => tab.classList.remove('active'));
        
        // Remove active class from all buttons
        const buttons = document.querySelectorAll('.tab-btn');
        buttons.forEach(btn => btn.classList.remove('active'));
        
        // Show selected tab
        document.getElementById(tabName).classList.add('active');
        
        // Add active class to clicked button
        event.target.classList.add('active');
        
        // Initialize chart if metrics tab is opened
        if (tabName === 'metrics' && !window.chartInitialized) {
            initializeChart();
            window.chartInitialized = true;
        }
    }

    // Initialize training chart
    function initializeChart() {
        const ctx = document.getElementById('trainingChart');
        if (!ctx) return;
        
        new Chart(ctx, {
            type: 'line',
            data: {
                labels: ['Epoch 0', 'Epoch 1', 'Epoch 2', 'Epoch 3', 'Epoch 4'],
                datasets: [{
                    label: 'Validation AUC (%)',
                    data: [97.05, 98.84, 98.79, 99.32, 99.03],
                    borderColor: 'rgb(76, 222, 128)',
                    backgroundColor: 'rgba(76, 222, 128, 0.1)',
                    tension: 0.4
                }, {
                    label: 'Training Loss',
                    data: [0.463, 0.335, 0.298, 0.258, 0.237],
                    borderColor: 'rgb(96, 165, 250)',
                    backgroundColor: 'rgba(96, 165, 250, 0.1)',
                    tension: 0.4,
                    yAxisID: 'y1'
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        labels: {
                            color: 'white'
                        }
                    }
                },
                scales: {
                    y: {
                        type: 'linear',
                        position: 'left',
                        title: {
                            display: true,
                            text: 'AUC (%)',
                            color: 'white'
                        },
                        ticks: {
                            color: 'white'
                        },
                        grid: {
                            color: 'rgba(255, 255, 255, 0.1)'
                        }
                    },
                    y1: {
                        type: 'linear',
                        position: 'right',
                        title: {
                            display: true,
                            text: 'Loss',
                            color: 'white'
                        },
                        ticks: {
                            color: 'white'
                        },
                        grid: {
                            display: false
                        }
                    },
                    x: {
                        ticks: {
                            color: 'white'
                        },
                        grid: {
                            color: 'rgba(255, 255, 255, 0.1)'
                        }
                    }
                }
            }
        });
    }

    const imageInput = document.getElementById('imageInput');
    const previewImage = document.getElementById('previewImage');
    const uploadArea = document.getElementById('uploadArea');
    const loading = document.getElementById('loading');
    const resultsDefault = document.getElementById('resultsDefault');
    const resultsContent = document.getElementById('resultsContent');

    // Handle file selection
    imageInput.addEventListener('change', function(e) {
        const file = e.target.files[0];
        if (file) {
            // Show preview
            const reader = new FileReader();
            reader.onload = function(e) {
                previewImage.src = e.target.result;
                previewImage.style.display = 'block';
            };
            reader.readAsDataURL(file);

            // Upload and analyze
            uploadAndAnalyze(file);
        }
    });

    // Drag and drop functionality
    uploadArea.addEventListener('dragover', function(e) {
        e.preventDefault();
        uploadArea.style.background = 'rgba(255, 255, 255, 0.2)';
    });

    uploadArea.addEventListener('dragleave', function(e) {
        uploadArea.style.background = '';
    });

    uploadArea.addEventListener('drop', function(e) {
        e.preventDefault();
        uploadArea.style.background = '';
        
        const file = e.dataTransfer.files[0];
        if (file && file.type.startsWith('image/')) {
            // Show preview
            const reader = new FileReader();
            reader.onload = function(e) {
                previewImage.src = e.target.result;
                previewImage.style.display = 'block';
            };
            reader.readAsDataURL(file);

            // Upload and analyze
            uploadAndAnalyze(file);
        }
    });

    async function uploadAndAnalyze(file) {
        // Show loading
        loading.style.display = 'block';
        resultsDefault.style.display = 'none';
        resultsContent.style.display = 'none';

        // Create form data
        const formData = new FormData();
        formData.append('image', file);

        try {
            console.log('Sending image to server...');
            
            // Use configured backend URL
            const backendUrl = API_CONFIG.getBaseUrl() + '/predict';
            console.log('Backend URL:', backendUrl);
            
            const response = await fetch(backendUrl, {
                method: 'POST',
                body: formData,
                headers: {
                    'Accept': 'application/json',
                }
            });

            console.log('Response status:', response.status);
            
            // Check if response is OK
            if (!response.ok) {
                const errorText = await response.text();
                console.error('Server error response:', errorText);
                throw new Error(`Server error: ${response.status} ${response.statusText}`);
            }

            // Parse response
            const responseText = await response.text();
            console.log('Response text:', responseText);
            
            let result;
            try {
                result = JSON.parse(responseText);
            } catch (jsonError) {
                console.error('Failed to parse JSON:', responseText);
                throw new Error('Server returned invalid response. Please ensure the Flask server is running.');
            }

            // Hide loading
            loading.style.display = 'none';

            if (result.error) {
                alert('Error: ' + result.error);
                resultsDefault.style.display = 'block';
                return;
            }

            // Display results
            console.log('Displaying results:', result);
            displayResults(result);

        } catch (error) {
            console.error('Error during upload:', error);
            loading.style.display = 'none';
            resultsDefault.style.display = 'block';
            
            let errorMessage = error.message;
            if (error.message.includes('Failed to fetch')) {
                errorMessage = 'Cannot connect to Flask server.\n\nPlease ensure:\n1. Flask server is running: python api/app.py\n2. Server is running on http://127.0.0.1:5000';
            } else if (error.message.includes('Server error')) {
                errorMessage = `Server error: ${error.message}\n\nThe Flask server may not have loaded the model correctly.`;
            }
            
            alert('Error analyzing image:\n\n' + errorMessage);
        }
    }

    function displayResults(result) {
        const prediction = result.prediction;
        const confidence = result.confidence;
        const probReal = result.probability_real;
        const probFake = result.probability_fake;

        // Update emoji
        document.getElementById('resultEmoji').textContent = prediction === 'Real' ? '‚úÖ' : '‚ùå';

        // Update label
        const labelEl = document.getElementById('resultLabel');
        labelEl.textContent = prediction.toUpperCase();
        labelEl.className = 'result-label ' + (prediction === 'Real' ? 'real' : 'fake');

        // Update confidence text
        document.getElementById('confidenceText').textContent = `Confidence: ${(confidence * 100).toFixed(2)}%`;

        // Update confidence bar
        const fillEl = document.getElementById('confidenceFill');
        fillEl.style.width = `${confidence * 100}%`;
        fillEl.style.background = prediction === 'Real' ? '#4ade80' : '#f87171';
        fillEl.textContent = `${(confidence * 100).toFixed(1)}%`;

        // Update probabilities
        document.getElementById('probReal').textContent = `${(probReal * 100).toFixed(2)}%`;
        document.getElementById('probFake').textContent = `${(probFake * 100).toFixed(2)}%`;

        // Show results
        resultsContent.style.display = 'block';
    }
</script>

</body>
</html>
